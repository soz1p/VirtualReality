using System.Collections;
using System.Collections.Generic;
using TMPro;
using UnityEngine;
using UnityEngine.UI; // UI? ?? ??????

public class cshOutdoorCall : MonoBehaviour
{
    public GameObject player;
    public GameObject assetToCall; // ??? ??
    public GameObject celebrationParticles; // ???? ??? ?? ??? ???
    public TMP_Text warningText; // ???? ?? ??? UI
    public Button lobbyButton; // ?? ??
    public Slider healthSlider; // ?? ?????
    private bool isAssetCalled = false; // ??? ?????? ???? ??? ??
    public static bool isSurvived = false; // ?????? ???? ??? ??


    // ? ????? ???? ?? ???
    public static List<GameObject> fires = new List<GameObject>();

    // Start is called before the first frame update
    void Start()
    {
        lobbyButton.gameObject.SetActive(false); // ?? ?? ? ?? ?? ????
        celebrationParticles.SetActive(false);
    }

    // Update is called once per frame
    void Update()
    {
        if (player.transform.position.y <= 31 && !isAssetCalled) // isAssetCalled? false? ?? ??? ??
        {
            Vector3 assetToCallPosition = player.transform.position + new Vector3(Random.Range(-100f, 100f), Random.Range(-10f, 5f), Random.Range(-100f, 100f));
            GameObject newAsset = Instantiate(assetToCall, assetToCallPosition, Quaternion.identity);
            newAsset.tag = "CallBox";
            newAsset.transform.rotation = Quaternion.Euler(-90f, 0f, 0f); // ??? x? ???? -90?? ??

            warningText.text = "Call 119"; // ???? ??? ??
            StartCoroutine(ClearTextAfterSeconds(5)); // 3? ?? ???? ??? ??? ??
            isAssetCalled = true; // ??? ??? ? ??? ??? true? ??
        }
    }

    // ?? ?? ?? ???? ??? ???
    IEnumerator ClearTextAfterSeconds(int seconds)
    {
        yield return new WaitForSeconds(seconds); // ??? ??? ??
        warningText.text = ""; // ??? ???
    }

    void OnTriggerEnter(Collider collision)
    {
        if (collision.gameObject.tag == "CallBox") // ??? ??? ??? "AssetTag"? ??
        {
            warningText.text = "You survived!"; // ???? ??? ??
            lobbyButton.gameObject.SetActive(true); // ?? ?? ? ?? ?? ???
            healthSlider.gameObject.SetActive(false); // ?? ????? ????
            celebrationParticles.SetActive(true); // ???? ?? ???
            isSurvived = true;

            // ?? ? ????? ????
            foreach (GameObject fire in fires)
            {
                fire.SetActive(false);
            }
        }
    }
}